function resourceCallBack(){cc.game.onStart=function(){cc.view.adjustViewPort(!0),thisismobile?cc.view.setDesignResolutionSize(640,1024,cc.ResolutionPolicy.EXACT_FIT):cc.view.setDesignResolutionSize(640,1024,cc.ResolutionPolicy.SHOW_ALL),cc.view.resizeWithBrowserSize(!0),MyLoaderScene.preload(g_resources,function(){cc.director.runScene(new gameScene)},this)},cc.game.run("gameCanvas")}var _size=null,Score=0,ScoreText=null,menuViewLayer=null,gameViewBackGroundLayer=null,gameView=null,hero=null,sbSize=null,_localStorage=null,test,gameViewXOffset=0,preBlackXOffset=0,currBlackXOffset=0,betweenXOffset=0,upBlackObject,gameScene=cc.Scene.extend({_score:0,onEnter:function(){this._super(),this.init()},init:function(){_size=cc.director.getWinSize(),gameViewBackGroundLayer=new BackGroundLayer,this.addChild(gameViewBackGroundLayer),gameView=new gameViewLayer,this.addChild(gameView),menuViewLayer=new menuLayer,this.addChild(menuViewLayer),_localStorage=cc.sys.localStorage,Score=this._score}}),gameViewLayer=cc.Layer.extend({_this:null,_start:!1,ctor:function(){this._super(),_this=this;var a=new cc.Sprite(res.stick_black);return sbSize=a.getContentSize(),a.setScale(180/sbSize.width,387/sbSize.height),a.x=_size.width/2,a.y=sbSize.height/2-50,this.addChild(a,1e3),hero=new npcController,heroSize=hero.getContentSize(),hero.x=_size.width/2,hero.y=sbSize.height+heroSize.height/2,this.addChild(hero,1e6),hero.yao(),cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,target:this,swallowTouches:!0,onTouchBegan:this.onTouchBegan,onTouchEnded:this.onTouchEnded},this),!0},startGame:function(){var a=180;gameViewXOffset=-a/2+_size.width/2,preBlackXOffset=a,this.runAction(cc.sequence(cc.moveBy(.2,cc.p(-gameViewXOffset,100)))),this.npcRun(.001),hero.runAction(cc.sequence(cc.moveBy(.2,cc.p(a/2-28,0)),cc.callFunc(this.npcYao,this),cc.callFunc(this.addBlock,this)))},onTouchBegan:function(){return _this._start?(_this.startSchedule(),!0):!1},onTouchEnded:function(){_this.stopSchedule()},addBlock:function(){_this._start=!0,upBlackObject=new cc.Sprite(res.stick_black),upBlackObject.setAnchorPoint(cc.p(.5,0));upBlackObject.getContentSize();upBlackObject.x=gameViewXOffset+preBlackXOffset-2.5,upBlackObject.y=sbSize.height,upBlackObject.setScaleY(0),this.addChild(upBlackObject);var a=120*cc.random0To1()+40,b=new cc.Sprite(res.stick_black),c=b.getContentSize();b.setScale(a/sbSize.width,387/sbSize.height),b.x=gameViewXOffset+_size.width+a/2,b.y=c.height/2-50,this.addChild(b);var d=_size.width-preBlackXOffset,e=(cc.random0To1()+.6)/2;currBlackXOffset=a,betweenXOffset=e*d,b.runAction(cc.sequence(cc.moveBy(.05,cc.p(-betweenXOffset,0))))},npcRun:function(a){hero.walk(a)},npcKick:function(){hero.kick()},npcShake:function(){hero.shake()},npcYao:function(){hero.yao()},startSchedule:function(){this.schedule(this.upBlack,.02),this.npcShake()},upBlack:function(a){var b=upBlackObject.getScaleY();upBlackObject.setScaleY(b+.07)},stopSchedule:function(){this.unschedule(this.upBlack),this.npcKick(),_this._start=!1,upBlackObject.runAction(cc.sequence(cc.delayTime(.3),cc.rotateBy(.1,90),cc.callFunc(this.rotateEnd,this)))},rotateEnd:function(){var a=upBlackObject.getContentSize(),b=upBlackObject.getScaleY()*a.height,c=betweenXOffset+preBlackXOffset,d=_size.width-c;b>=d+5&&d+currBlackXOffset>=b?this.next(d+currBlackXOffset):b>d+currBlackXOffset?this.gameOver(d+currBlackXOffset+50):this.gameOver(b+30)},next:function(a){var b=a/500;this.npcRun(b/30),hero.runAction(cc.sequence(cc.moveBy(b,cc.p(a,0)),cc.callFunc(this.nextBlack,this)))},gameOver:function(a){var b=a/500;this.npcRun(b/30),hero.runAction(cc.sequence(cc.moveBy(b,cc.p(a,0)),cc.callFunc(this.gameFaile,this)))},nextBlack:function(){Score++,ScoreText.setString(Score),Score>_localStorage.getItem("bestScore")&&_localStorage.setItem("bestScore",Score),this.npcYao(),preBlackXOffset=currBlackXOffset+40;var a=_size.width-betweenXOffset-40;gameViewXOffset+=a,this.runAction(cc.sequence(cc.moveBy(.3,cc.p(-a,0)),cc.callFunc(this.addBlock,this)))},gameFaile:function(){this.npcYao(),hero.runAction(cc.sequence(cc.moveTo(.3,cc.p(hero.getPositionX(),-200)),cc.callFunc(this.addGameFailView,this))),upBlackObject.runAction(cc.sequence(cc.rotateBy(.1,90)))},addGameFailView:function(){var a=new gameOverViewLayer;this.addChild(a,1e3)}}),menuLayer=cc.Layer.extend({ctor:function(){this._super();var a=new cc.MenuItemImage(res.startBtn,res.startBtn,this.startCallFun,this);return this.startMenu=new cc.Menu(a),this.addChild(this.startMenu),this.startMenu.x=_size.width/2,this.startMenu.y=_size.height/2,!0},startCallFun:function(){this.removeFromParent(!0),gameViewBackGroundLayer.initBasic(),gameView.startGame()}}),BackGroundLayer=cc.Layer.extend({ctor:function(){this._super();var a=new cc.Sprite(res.gameBg);return a.x=_size.width/2,a.y=_size.height/2,this.addChild(a,0),!0},initBasic:function(){var a=new cc.Sprite(res.scoreBg);a.x=_size.width/2,a.y=_size.height/2+350,this.addChild(a,0),ScoreText=new cc.LabelTTF("0","bold 宋体",46),ScoreText.x=_size.width/2,ScoreText.y=_size.height/2+350,ScoreText.fillStyle=new cc.color(255,255,255,255),this.addChild(ScoreText,2)}}),gameOverViewLayer=cc.Layer.extend({ctor:function(){this._super();var a=_size.width/2+gameViewXOffset,b=_size.height/2-100,c=new cc.Sprite(res.overSoreBg);c.x=a,c.y=b,this.addChild(c,1e3);var d=new cc.LabelTTF(""+Score,"Arial",36);d.x=a+100,d.y=_size.height/2+20,d.fillStyle=new cc.color(255,0,0,255),this.addChild(d,1001);var e=_localStorage.getItem("bestScore"),f=new cc.LabelTTF(""+e,"Arial",36);f.x=a+100,f.y=_size.height/2-35,f.fillStyle=new cc.color(255,0,0,255),this.addChild(f,1001);var g=new cc.MenuItemImage(res.again,res.again,this.againCallFun,this),h=new cc.Menu(g);this.addChild(h,1001),h.x=a-130,h.y=b-90;var i=new cc.MenuItemImage(res.more,res.more,this.moreCallFun,this),j=new cc.Menu(i);return this.addChild(j,1001),j.x=a+130,j.y=b-90,!0},againCallFun:function(){this.removeFromParent(!0),cc.director.runScene(new gameScene)},moreCallFun:function(){window.location.href=g_link}}),npcController=cc.Sprite.extend({texture:null,ctor:function(){this._super(),this.yaoTexture=cc.textureCache.addImage(res.yao),this.walkTexture=cc.textureCache.addImage(res.walk),this.kickTexture=cc.textureCache.addImage(res.kick),this.shakeTexture=cc.textureCache.addImage(res.shake);var a=new cc.SpriteFrame(this.yaoTexture,cc.rect(0,0,122,122));this.setSpriteFrame(a)},walk:function(a){this.stopAllActions();for(var b=[],c=0;11>c;c++){var d=new cc.SpriteFrame(this.walkTexture,cc.rect(122*c,0,122,122));b.push(d)}var e=new cc.Animation(b,a),f=cc.Animate.create(e).repeatForever();this.runAction(f)},shake:function(){this.stopAllActions();for(var a=[],b=0;5>b;b++){var c=new cc.SpriteFrame(this.shakeTexture,cc.rect(122*b,0,122,122));a.push(c)}var d=new cc.Animation(a,.1),e=cc.Animate.create(d).repeatForever();this.runAction(e)},kick:function(){this.stopAllActions();for(var a=[],b=0;6>b;b++){var c=new cc.SpriteFrame(this.kickTexture,cc.rect(122*b,0,122,122));a.push(c)}var d=new cc.Animation(a,.1),e=cc.Animate.create(d).repeatForever();this.runAction(e)},yao:function(){this.stopAllActions();for(var a=[],b=0;5>b;b++){var c=new cc.SpriteFrame(this.yaoTexture,cc.rect(122*b,0,122,122));a.push(c)}var d=new cc.Animation(a,.1),e=cc.Animate.create(d).repeatForever();this.runAction(e)}}),MyLoaderScene=cc.Scene.extend({_interval:null,_length:0,_count:0,_label:null,_className:"MyLoaderScene",init:function(){var a=this,b=a._bgLayer=cc.LayerColor.create(cc.color(32,32,32,255));b.setPosition(cc.visibleRect.bottomLeft),a.addChild(b,0);var c=24,d=cc.director.getWinSize(),e=cc.Sprite.create(g_loadingPage);e.setPosition(d.width/2,d.height/2),e.setScale(1),b.addChild(e,0);var f=a._label=cc.LabelTTF.create("Loading... 0%","Arial",c);return f.setPosition(d.width/2,d.height/2-200),f.setColor(cc.color(255,255,255)),b.addChild(this._label,10),!0},_initStage:function(a,b){var c=this,d=c._texture2d=new cc.Texture2D;d.initWithElement(a),d.handleLoadedTexture();var e=c._logo=cc.Sprite.create(d);e.setScale(cc.contentScaleFactor()),e.x=b.x,e.y=b.y,c._bgLayer.addChild(e,10)},onEnter:function(){var a=this;cc.Node.prototype.onEnter.call(a),a.schedule(a._startLoading,.3)},onExit:function(){cc.Node.prototype.onExit.call(this);var a="Loading... 100%";this._label.setString(a)},initWithResources:function(a,b){"string"==typeof a&&(a=[a]),this.resources=a||[],this.cb=b},_startLoading:function(){var a=this;a.unschedule(a._startLoading);var b=a.resources;cc.loader.load(b,function(b,c,d){var e=d/c*100|0;e=Math.min(e,100),a._label.setString("Loading... "+e+"%")},function(){a.cb&&a.cb()})},_updatePercent:function(){var a=this,b=a._count,c=a._length,d=b/c*100|0;d=Math.min(d,100),a._label.setString("Loading... "+d+"%"),b>=c&&a.unschedule(a._updatePercent)}});MyLoaderScene.preload=function(a,b){var c=null;return c||(c=new MyLoaderScene,c.init()),c.initWithResources(a,b),cc.director.runScene(c),c};var thisismobile=!1;thisismobile=/AppleWebKit.*Mobile/i.test(navigator.userAgent)||/MIDP|SymbianOS|NOKIA|SAMSUNG|LG|NEC|TCL|Alcatel|BIRD|DBTEL|Dopod|PHILIPS|HAIER|LENOVO|MOT-|Nokia|SonyEricsson|SIE-|Amoi|ZTE/.test(navigator.userAgent)?!0:!1;