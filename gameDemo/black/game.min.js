function resourceCallBack(){cc.game.onStart=function(){cc.view.adjustViewPort(!0),thisismobile?cc.view.setDesignResolutionSize(640,1024,cc.ResolutionPolicy.EXACT_FIT):cc.view.setDesignResolutionSize(640,1024,cc.ResolutionPolicy.SHOW_ALL),cc.view.resizeWithBrowserSize(!0),MyLoaderScene.preload(g_resources,function(){cc.director.runScene(new BeginScene)},this)},cc.game.run("gameCanvas")}var GC=GC||{};GC.size=cc.size(640,1e3),GC.w=GC.size.width,GC.h=GC.size.height,GC.w2=GC.w/2,GC.h2=GC.h/2,GC.titleSpace=1,GC.menuItem=[{title:"经典",color:cc.color.WHITE,labelColor:cc.color.BLACK,subItem:["25","50","不连续","5x5","6x6"]},{title:"街机",color:cc.color.BLACK,labelColor:cc.color.WHITE,subItem:["正常","更快","逆行","5x5","6x6"]},{title:"禅",color:cc.color.BLACK,labelColor:cc.color.WHITE,subItem:["15''","30''","不连续","5x5","6x6"]},{title:"极速",color:cc.color.WHITE,labelColor:cc.color.BLACK,subItem:["正常","逆行","不连续","5x5","6x6"]},{title:"接力",color:cc.color.WHITE,labelColor:cc.color.BLACK,subItem:["8''","10''","12''","5x5","6x6"]},{title:"街机+",color:cc.color.BLACK,labelColor:cc.color.WHITE,subItem:["雷电","闪电","双黑","双层","迷雾","变速","旋转","震动","多云","移动","梦幻"]},{title:"随机",color:cc.color.BLACK,labelColor:cc.color.WHITE,subItem:[]},{title:"更多",color:cc.color.WHITE,labelColor:cc.color.BLACK,subItem:[]}];var TileType={};TileType.START_LINE=0,TileType.TOUCH=1,TileType.DONT_TOUCH=2;var TileSprite=cc.Sprite.extend({type:TileType.DONT_TOUCH,_callBackFunc:null,_listener:null,ctor:function(a,b){return this._super(),this.loadConfig(b),this.loadInit(a),!0},loadConfig:function(a){this._callBackFunc=a},loadInit:function(a){this.setTextureRect(cc.rect(0,0,a.width,a.height)),this.setColor(new cc.color(253,230,173))},loadListener:function(){var a=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,target:this,swallowTouches:!0,onTouchBegan:this.onTouchBegan,onTouchMoved:this.onTouchMoved,onTouchEnded:this.onTouchEnded});cc.eventManager.addListener(a,this)},onTouchBegan:function(a,b){var c=this.target,d=c.convertToNodeSpace(a.getLocation()),e=c.getContentSize(),f=cc.rect(0,0,e.width,e.height);return cc.rectContainsPoint(f,d)?(c.onTouchDispose(),!0):!1},onTouchMoved:function(a,b){},onTouchEnded:function(a,b){},onTouchDispose:function(){if(!GlobalGameCheck){GlobalPlay=!0;var a=this,b=cc.callFunc(function(){var b=a.type==TileType.DONT_TOUCH?!0:!1;a._callBackFunc&&"function"==typeof a._callBackFunc&&a._callBackFunc(a,b)}),c=cc.scaleTo(.02,1),d=cc.blink(.2,2),e=cc.sequence(c,b),f=cc.sequence(d,b),g=this.type==TileType.TOUCH?e:f,h=this.type==TileType.TOUCH?cc.color.GRAY:cc.color.RED,i=this.type==TileType.TOUCH?.1:1,j=new cc.Sprite;this.addChild(j),j.setPosition(this.width/2,this.height/2),j.setTextureRect(cc.rect(0,0,this.width,this.height)),j.scale=i,j.color=h,j.runAction(g)}},setTouchEnabled:function(a){this._listener?a?cc.eventManager.addListener(this._listener,this):cc.eventManager.removeListener(this._listener):cc.error("this._listener 为空...")},setType:function(a){switch(a){case TileType.START_LINE:this.setColor(cc.color.YELLOW);break;case TileType.TOUCH:this.initWithFile(res.test);break;case TileType.DONT_TOUCH:}this.type=a}}),loadingSprite=cc.Sprite.extend({textureWidth:null,textureHeight:null,ctor:function(){this._super(),this.init()},init:function(){this.initWithFile(res.time_bg2),this.textureWidth=this.getContentSize().width,this.textureHeight=this.getContentSize().height,this.setPosition(65,GC.h-62),this.setAnchorPoint(0,.5)},setPrecent:function(a){var b=this.getTextureRect(),c=a/1e3;this.setTextureRect(cc.rect(b.x,b.y,this.textureWidth*c,this.textureHeight))}}),GameOverLayer=cc.LayerColor.extend({_model:-1,_playMethod:-1,_count:-1,_time:-1,_isWin:!1,ctor:function(a){return this._super(),this.loadConfig(a),this.loadInit(),this.loadTitle(),this.loadMenu(),!0},loadConfig:function(a){this._model=a.model,this._playMethod=a.playMethod,this._count=a.count,this._time=a.time,this._isWin=a.isWin,cc.log(a.count)},loadInit:function(){var a=this._isWin?cc.color(0,155,45):cc.color(180,0,0);this.setColor(a)},loadTitle:function(){var a=GC.menuItem[this._model].title+"模式",b=new cc.LabelTTF(a,"Arial",64);this.addChild(b),b.setPosition(GC.w2,GC.h-200);var c=GC.menuItem[this._model].subItem[this._playMethod],d=new cc.LabelTTF(c,"Arial",24);this.addChild(d),d.setPosition(b.x+120,b.y+60);var e=this._isWin?"赢了！":"输了!",f=new cc.LabelTTF(e,"Arial",200);this.addChild(f),f.setPosition(GC.w2,GC.h2),f.setColor(cc.color.BLACK);var g=/([0-9]+\.[0-9]{3})[0-9]*/,h=String(this._time),i=h.replace(g,"$1''"),j=5,k=this._time>j?"历史记录 "+i:"新纪录 "+i,l=new cc.LabelTTF(k,"Arial",48);this.addChild(l),l.setPosition(GC.w2,GC.h2-150),l.setColor(cc.color.BLACK)},loadMenu:function(){var a=new cc.LabelTTF("继续玩","Arial",48),b=new cc.MenuItemLabel(a,function(){var a=new cc.Scene,b=new GamePlayLayer(this._model,this._playMethod);a.addChild(b),cc.director.runScene(a)},this),c=new cc.LabelTTF("结束","Arial",48),d=new cc.MenuItemLabel(c,function(){cc.director.runScene(new MainMenuScene)},this),e=new cc.Menu(b,d);this.addChild(e),e.setPosition(GC.w2,200),e.alignItemsHorizontallyWithPadding(30)}}),Direction=Direction||{};Direction.UP=cc.p(0,1),Direction.LEFT=cc.p(1,0),Direction.DOWN=cc.p(0,-1),Direction.RIGHT=cc.p(-1,0);var GameState={};GameState.READY=0,GameState.START=1,GameState.PLAYING=2,GameState.END=3;var GlobalPlay=!1,GlobalGameCheck=!1,GamePlayLayer=cc.Layer.extend({_model:-1,_playMethod:-1,_row:6,_col:4,_tileSize:cc.size(0,0),_tiles:null,_tileMaxNum:Number.MAX_VALUE,_tileLayer:null,_moveDir:Direction.DOWN,_tapTileCount:0,_time:1,_blackBlockLabel:null,_isWin:!0,_gameState:GameState.READY,TheGamePlayTime:1e3,ctor:function(a,b){this._super();var c=new cc.Sprite(res.topbar);c.anchorY=1,c.x=GC.w2,c.y=cc.visibleRect.top.y,this.addChild(c,10);var d=new cc.Sprite(res._bottom);return d.anchorY=0,d.x=GC.w2,d.y=cc.visibleRect.bottom.y,this.addChild(d,10),this.timeLoadingBar=new loadingSprite,this.timeLoadingBar.setPrecent(1e3),this.addChild(this.timeLoadingBar,100),this.loadConfig(a,b),this.loadInit(),this.loadStartTitle(),this.scheduleUpdate(),!0},loadConfig:function(a,b){this._model=a,this._playMethod=b,this._tiles=new Array;var c=GC.menuItem[a].subItem[b];if(b>=GC.menuItem[a].subItem.length-2){var d=parseInt(c.substring(0,1)),e=parseInt(c.substring(c.length-1,c.length));this._row=d>=0?d:4,this._col=e>=0?e:4}this._moveDir=1==a&&2==b?Direction.UP:Direction.DOWN,0==a&&(0==b?this._tileMaxNum=parseInt(c):this._tileMaxNum=50);var f=(GC.w-GC.titleSpace*this._col)/this._col,g=(GC.h-GC.titleSpace*this._row)/this._row;this._tileSize=cc.size(f,g)},loadInit:function(){this._tileLayer=new cc.Layer,this.addChild(this._tileLayer),this._tileLayer.setPosition(0,165),this._blackBlockLabel=new cc.LabelTTF(this._tapTileCount,"Arial",120),this.addChild(this._blackBlockLabel,10),this._blackBlockLabel.setPosition(GC.w2,GC.h-this._blackBlockLabel.height-150),this._blackBlockLabel.setColor(cc.color.RED);for(var a=0;a<this._row+1;a++){this._tiles[a]=new Array;for(var b=Math.floor(Math.random()*this._col),c=0;c<this._col;c++){var d=!0,e=TileType.DONT_TOUCH;b==c&&(e=TileType.TOUCH,d=!1);var f=c*(this._tileSize.width+GC.titleSpace)+this._tileSize.width/2,g=a*(this._tileSize.height+GC.titleSpace)+this._tileSize.height/2,h=this.createTileSprite(f,g,e);this._tileLayer.addChild(h),this._tiles[a].push(h),0!=d&&h.loadListener()}}},onTileMove:function(){var a=cc.callFunc(this.addTile.bind(this)),b=cc.moveBy(.01,cc.p(this._moveDir.x*this._tileSize.width,this._moveDir.y*(this._tileSize.height+GC.titleSpace))),c=cc.sequence(b,a);this._tileLayer.runAction(c)},onTileCallBack:function(a,b){var c=this.parent.parent;1==b?(c._isWin=!1,GlobalPlay=!1,GlobalGameCheck=!0,cc.director.runScene(new EndScene),console.log("end success")):c.onTileMove()},update:function(a){GlobalPlay&&(this._time+=1,this._time%2==0&&(this.TheGamePlayTime-=1,this._time=1,this.timeLoadingBar.setPrecent(this.TheGamePlayTime)),0==this.TheGamePlayTime&&(this.TheGamePlayTime=0,this._isWin=!1,GlobalPlay=!1,GlobalGameCheck=!0,cc.director.runScene(new EndScene),console.log("time end")),this._blackBlockLabel.setString(this._tapTileCount))},createTileSprite:function(a,b,c){var d=new TileSprite(this._tileSize,this.onTileCallBack);return d.setPosition(a,b),d.setType(c),d},addTile:function(a){for(var b=0;b<this._tiles[0].length;b++)this._tiles[0][b].removeFromParent();this._tiles.shift();for(var b=0;b<this._tiles[0].length;b++)this._tiles[0][b].loadListener();this._tiles[this._tiles.length]=new Array;for(var c=Math.floor(Math.random()*this._col),b=0;b<this._col;b++){var d=TileType.DONT_TOUCH;c==b&&(d=TileType.TOUCH);var e=b*(this._tileSize.width+GC.titleSpace)+this._tileSize.width/2,f=GC.h+1.5*this._tileSize.height+GC.titleSpace+this._tapTileCount*(this._tileSize.height+GC.titleSpace),g=this.createTileSprite(e,f,d);this._tileLayer.addChild(g),this._tiles[this._tiles.length-1].push(g)}this._tapTileCount+=1},transitionToGameOver:function(){var a={model:this._model,playMethod:this._playMethod,count:this._tapTileCount,time:this._time,isWin:this._isWin},b=new cc.Scene,c=new GameOverLayer(a);b.addChild(c),cc.director.runScene(b)},loadStartTitle:function(){for(var a=0;a<this._tiles[0].length;a++){var b=this._tiles[0][a];if(b.type==TileType.TOUCH)return void b.loadListener()}}}),GamePlayScene=cc.Scene.extend({onEnter:function(){this._super();var a=new GamePlayLayer;this.addChild(a)}}),BeginScene=cc.Scene.extend({ctor:function(){this._super(),this.init()},init:function(){var a=cc.director.getWinSize(),b=this,c=cc.Sprite.create(res.shouye);c.setPosition(a.width/2,a.height/2),this.addChild(c,0);var d=new cc.MenuItemImage(res.beginbut,res.beginbut,function(){var a=new cc.Scene,b=new GamePlayLayer(0,1);a.addChild(b),cc.director.runScene(a)},this),e=new cc.Menu(d);e.x=a.width/2,e.y=a.height/2+150,this.addChild(e,1);var f=new cc.MenuItemImage(res.guize,res.guize,function(){b.addChild(h,1),b.addChild(j,3),e.setVisible(!1),g.setVisible(!1)},this),g=new cc.Menu(f);g.x=a.width/2,g.y=a.height/4,this.addChild(g,1);var h=cc.Sprite.create(res.rule);h.setPosition(a.width/2,a.height/2);var i=new cc.MenuItemImage(res.back,res.back,function(){b.removeChild(h,1),b.removeChild(j,3),e.setVisible(!0),g.setVisible(!0)},this),j=new cc.Menu(i);j.x=a.width/2,j.y=a.height/4},onExit:function(){this.removeAllChildrenWithCleanup(!0)}}),EndScene=cc.Scene.extend({ctor:function(){this._super(),this.init()},init:function(){var a=cc.director.getWinSize(),b=cc.Sprite.create(res.shouye);b.setPosition(a.width/2,a.height/2),this.addChild(b,0);var c=new cc.MenuItemImage(res.beginbut,res.beginbut,function(){cc.director.runScene(new BeginScene),reSet()},this),d=new cc.Menu(c);d.x=a.width/2,d.y=a.height/2,this.addChild(d,1);var e=new cc.MenuItemImage(res.more,res.more,function(){window.location.href=g_link},this),f=new cc.Menu(e);f.x=a.width/2,f.y=cc.visibleRect.bottom.y+100,this.addChild(f,1)},onExit:function(){this.removeAllChildrenWithCleanup(!0)}}),reSet=function(){GlobalPlay=!1,GlobalGameCheck=!1},MyLoaderScene=cc.Scene.extend({_interval:null,_length:0,_count:0,_label:null,_className:"MyLoaderScene",init:function(){var a=this,b=a._bgLayer=cc.LayerColor.create(cc.color(32,32,32,255));b.setPosition(cc.visibleRect.bottomLeft),a.addChild(b,0);var c=24,d=cc.director.getWinSize(),e=cc.Sprite.create("res/loadingpage.jpg");e.setPosition(d.width/2,d.height/2),e.setScale(1),b.addChild(e,0);var f=a._label=cc.LabelTTF.create("Loading... 0%","Arial",c);return f.setPosition(d.width/2,d.height/2-200),f.setColor(cc.color(255,255,255)),b.addChild(this._label,10),!0},_initStage:function(a,b){var c=this,d=c._texture2d=new cc.Texture2D;d.initWithElement(a),d.handleLoadedTexture();var e=c._logo=cc.Sprite.create(d);e.setScale(cc.contentScaleFactor()),e.x=b.x,e.y=b.y,c._bgLayer.addChild(e,10)},onEnter:function(){var a=this;cc.Node.prototype.onEnter.call(a),a.schedule(a._startLoading,.3),a.schedule(a._updatePercent,.3)},onExit:function(){cc.Node.prototype.onExit.call(this);var a="Loading... 100%";this._label.setString(a)},initWithResources:function(a,b){"string"==typeof a&&(a=[a]),this.resources=a||[],this.cb=b},_startLoading:function(){var a=this;a.unschedule(a._startLoading);var b=a.resources;cc.loader.load(b,function(b,c,d){var e=d/c*100|0;e=Math.min(e,100),a._label.setString("Loading... "+e+"%")},function(){a.cb&&a.cb()})},_updatePercent:function(){var a=this,b=a._count,c=a._length,d=b/c*100|0;d=Math.min(d,100),a._label.setString("Loading... "+d+"%"),b>=c&&a.unschedule(a._updatePercent)}});MyLoaderScene.preload=function(a,b){var c=null;return c||(c=new MyLoaderScene,c.init()),c.initWithResources(a,b),cc.director.runScene(c),c};var thisismobile=!1;thisismobile=/AppleWebKit.*Mobile/i.test(navigator.userAgent)||/MIDP|SymbianOS|NOKIA|SAMSUNG|LG|NEC|TCL|Alcatel|BIRD|DBTEL|Dopod|PHILIPS|HAIER|LENOVO|MOT-|Nokia|SonyEricsson|SIE-|Amoi|ZTE/.test(navigator.userAgent)?!0:!1;